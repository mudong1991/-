<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Django项目部署教程.md—C:\Users\Administrator.2013-20160229XQ\Desktop\python\python相关知识</title>
    <style type="text/css">
    body{font-family:Helvetica,arial,sans-serif;font-size:14px;line-height:1.6;padding-top:10px;padding-bottom:10px;background-color:white;padding:30px;color:#333}body>*:first-child{margin-top:0!important}body>*:last-child{margin-bottom:0!important}a{color:#4183c4;text-decoration:none}a:hover{text-decoration:underline}a.absent{color:#c00}a.anchor{display:block;padding-left:30px;margin-left:-30px;cursor:pointer;position:absolute;top:0;left:0;bottom:0}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0}kbd{background:#f1f1f1;background:-moz-linear-gradient(#f1f1f1,#ddd);background:-webkit-linear-gradient(#f1f1f1,#ddd);-ms-filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#f1f1f1', endColorstr='#dddddd')";border-radius:2px;border:1px solid #ddd;border-bottom-color:#ccc;border-right-color:#ccc;padding:1px 4px;line-height:10px;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}.container{max-width:920px;margin:0 auto 20px auto}#header{background:#fafafa;background:-moz-linear-gradient(#fafafa,#eaeaea);background:-webkit-linear-gradient(#fafafa,#eaeaea);-ms-filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#fafafa', endColorstr='#eaeaea')";border-bottom:1px solid #cacaca;box-shadow:0 1px 0 rgba(255,255,255,0.4),0 0 10px rgba(0,0,0,0.1)}#markup{padding:3px}#markup article{padding-top:30px}.markdown-body{font-size:14px;line-height:1.6}.markdown-body>*:first-child{margin-top:0!important}.markdown-body>*:last-child{margin-bottom:0!important}.markdown-body a.absent{color:#c00}.markdown-body a.anchor{bottom:0;cursor:pointer;display:block;left:0;margin-left:-30px;padding-left:30px;position:absolute;top:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{cursor:text;font-weight:bold;margin:20px 0 10px;padding:0;position:relative}.markdown-body h1 .mini-icon-link,.markdown-body h2 .mini-icon-link,.markdown-body h3 .mini-icon-link,.markdown-body h4 .mini-icon-link,.markdown-body h5 .mini-icon-link,.markdown-body h6 .mini-icon-link{color:#000;display:none}.markdown-body h1:hover a.anchor,.markdown-body h2:hover a.anchor,.markdown-body h3:hover a.anchor,.markdown-body h4:hover a.anchor,.markdown-body h5:hover a.anchor,.markdown-body h6:hover a.anchor{line-height:1;margin-left:-22px;padding-left:0;text-decoration:none;top:15%}.markdown-body h1:hover a.anchor .mini-icon-link,.markdown-body h2:hover a.anchor .mini-icon-link,.markdown-body h3:hover a.anchor .mini-icon-link,.markdown-body h4:hover a.anchor .mini-icon-link,.markdown-body h5:hover a.anchor .mini-icon-link,.markdown-body h6:hover a.anchor .mini-icon-link{display:inline-block}.markdown-body h1 tt,.markdown-body h1 code,.markdown-body h2 tt,.markdown-body h2 code,.markdown-body h3 tt,.markdown-body h3 code,.markdown-body h4 tt,.markdown-body h4 code,.markdown-body h5 tt,.markdown-body h5 code,.markdown-body h6 tt,.markdown-body h6 code{font-size:inherit}.markdown-body h1{color:#000;font-size:28px}.markdown-body h2{border-bottom:1px solid #ccc;color:#000;font-size:24px}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h6{color:#777;font-size:14px}.markdown-body p,.markdown-body blockquote,.markdown-body ul,.markdown-body ol,.markdown-body dl,.markdown-body table,.markdown-body pre{margin:15px 0}.markdown-body hr{background:url("/public/github-dirty-shade.png") repeat-x scroll 0 0 transparent;border:0 none;color:#ccc;height:4px;padding:0}.markdown-body>h2:first-child,.markdown-body>h1:first-child,.markdown-body>h1:first-child+h2,.markdown-body>h3:first-child,.markdown-body>h4:first-child,.markdown-body>h5:first-child,.markdown-body>h6:first-child{margin-top:0;padding-top:0}.markdown-body a:first-child h1,.markdown-body a:first-child h2,.markdown-body a:first-child h3,.markdown-body a:first-child h4,.markdown-body a:first-child h5,.markdown-body a:first-child h6{margin-top:0;padding-top:0}.markdown-body h1+p,.markdown-body h2+p,.markdown-body h3+p,.markdown-body h4+p,.markdown-body h5+p,.markdown-body h6+p{margin-top:0}.markdown-body li p.first{display:inline-block}.markdown-body ul,.markdown-body ol{padding-left:30px}.markdown-body ul.no-list,.markdown-body ol.no-list{list-style-type:none;padding:0}.markdown-body ul li>*:first-child,.markdown-body ol li>*:first-child{margin-top:0}.markdown-body ul ul,.markdown-body ul ol,.markdown-body ol ol,.markdown-body ol ul{margin-bottom:0}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:14px;font-style:italic;font-weight:bold;margin:15px 0 5px;padding:0}.markdown-body dl dt:first-child{padding:0}.markdown-body dl dt>*:first-child{margin-top:0}.markdown-body dl dt>*:last-child{margin-bottom:0}.markdown-body dl dd{margin:0 0 15px;padding:0 15px}.markdown-body dl dd>*:first-child{margin-top:0}.markdown-body dl dd>*:last-child{margin-bottom:0}.markdown-body blockquote{border-left:4px solid #ddd;color:#777;padding:0 15px}.markdown-body blockquote>*:first-child{margin-top:0}.markdown-body blockquote>*:last-child{margin-bottom:0}.markdown-body table{border-collapse:collapse;border-spacing:0}.markdown-body table th{font-weight:bold}.markdown-body table th,.markdown-body table td{border:1px solid #ccc;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#f8f8f8;border:1px solid #eaeaea;border-radius:3px 3px 3px 3px;margin:0 2px;padding:0 5px;white-space:nowrap}.markdown-body pre>code{background:none repeat scroll 0 0 transparent;border:medium none;margin:0;padding:0;white-space:pre}.markdown-body .highlight pre,.markdown-body pre{background-color:#f8f8f8;border:1px solid #ccc;border-radius:3px 3px 3px 3px;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px}.markdown-body pre code,.markdown-body pre tt{background-color:transparent;border:medium none}.codehilite{background:#fff}.codehilite .c{color:#998;font-style:italic}.codehilite .err{color:#a61717;background-color:#e3d2d2}.codehilite .k{color:#000;font-weight:bold}.codehilite .o{color:#000;font-weight:bold}.codehilite .cm{color:#998;font-style:italic}.codehilite .cp{color:#999;font-weight:bold}.codehilite .c1{color:#998;font-style:italic}.codehilite .cs{color:#999;font-weight:bold;font-style:italic}.codehilite .gd{color:#000;background-color:#fdd}.codehilite .gd .x{color:#000;background-color:#faa}.codehilite .ge{color:#000;font-style:italic}.codehilite .gr{color:#a00}.codehilite .gh{color:#999}.codehilite .gi{color:#000;background-color:#dfd}.codehilite .gi .x{color:#000;background-color:#afa}.codehilite .go{color:#888}.codehilite .gp{color:#555}.codehilite .gs{font-weight:bold}.codehilite .gu{color:#aaa}.codehilite .gt{color:#a00}.codehilite .kc{color:#000;font-weight:bold}.codehilite .kd{color:#000;font-weight:bold}.codehilite .kp{color:#000;font-weight:bold}.codehilite .kr{color:#000;font-weight:bold}.codehilite .kt{color:#458;font-weight:bold}.codehilite .m{color:#099}.codehilite .s{color:#d14}.codehilite .na{color:#008080}.codehilite .nb{color:#0086b3}.codehilite .nc{color:#458;font-weight:bold}.codehilite .no{color:#008080}.codehilite .ni{color:#800080}.codehilite .ne{color:#900;font-weight:bold}.codehilite .nf{color:#900;font-weight:bold}.codehilite .nn{color:#555}.codehilite .nt{color:#000080}.codehilite .nv{color:#008080}.codehilite .ow{color:#000;font-weight:bold}.codehilite .w{color:#bbb}.codehilite .mf{color:#099}.codehilite .mh{color:#099}.codehilite .mi{color:#099}.codehilite .mo{color:#099}.codehilite .sb{color:#d14}.codehilite .sc{color:#d14}.codehilite .sd{color:#d14}.codehilite .s2{color:#d14}.codehilite .se{color:#d14}.codehilite .sh{color:#d14}.codehilite .si{color:#d14}.codehilite .sx{color:#d14}.codehilite .sr{color:#009926}.codehilite .s1{color:#d14}.codehilite .ss{color:#990073}.codehilite .bp{color:#999}.codehilite .vc{color:#008080}.codehilite .vg{color:#008080}.codehilite .vi{color:#008080}.codehilite .il{color:#099}
    </style>
    <style type="text/css">
      .markdown-body hr{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC")}
    </style>
  </head>
  <body>
    <div class="container">
      <div id="markup">
        <article id="content" class="markdown-body">
          <div class="toc">
<ul>
<li><a href="#linuxnginxmysqluwsgidjangoopenssl">Linux+nginx+mysql+uwsgi+django+openssl 项目部署</a><ul>
<li><a href="#_1">一、环境</a></li>
<li><a href="#nginx">二、安装nginx</a></li>
<li><a href="#mysql">三、安装mysql</a></li>
<li><a href="#python">四、安装python、虚拟环境及包管理</a><ul>
<li><a href="#1python">1、安装python</a></li>
<li><a href="#2pip">2、安装pip</a></li>
<li><a href="#3pyenvpython">3、安装pyenv（python版本管理器）</a></li>
<li><a href="#4virtualenvpython">4、安装virtualenv（python虚拟环境）</a></li>
</ul>
</li>
<li><a href="#uwsgi">五、安装uwsgi</a></li>
<li><a href="#nginx_1">六、设置nginx</a></li>
<li><a href="#openssl">七、openssl加入</a></li>
</ul>
</li>
</ul>
</div>
<hr>
<h1 id="linuxnginxmysqluwsgidjangoopenssl">Linux+nginx+mysql+uwsgi+django+openssl 项目部署</h1>
<blockquote>
<p>"青春本应不凡！"---阿东 | 本文介绍了关于django项目的项目部署，让你django能顺利在linux系统上运行，本pythoneer也在这过程中遇坑无数，在这里写下教程文档，希望大家少走弯路。</p>
</blockquote>
<h2 id="_1">一、环境</h2>
<p>系统:centos 6.5 64bit 最小安装版 <br>
nginx-1.8.1 <br>
mysql-5.5.48 <br>
uwsgi-2.0.13.1 <br>
python-2.7.11 <br>
django-1.8.10   </p>
<h2 id="nginx">二、安装nginx</h2>
<p><em>本章介绍了如何在Linux系统上实现nginx的手动安装以及配置。</em></p>
<p><strong>1、下载nginx安装包</strong></p>
<p>可以去nginx官网平台直接下载到，nginx下载地址: <a href="http://nginx.org/en/download.html" target="_blank"> http://nginx.org/en/download.html </a></p>
<p><strong>2、安装相关开发组件包</strong></p>
<div class="codehilite"><pre> <span class="c1"># yum groupinstall &quot;Development tools&quot; &quot;Server Platform Development&quot; -y</span>
 <span class="c1"># yum install openssl-devel pcre-devel -y        #正则表达式和open-ssl支持</span>
</pre></div>


<p><strong>3、添加nginx用户和编译nginx</strong></p>
<div class="codehilite"><pre><span class="c1"># groupadd -r nginx</span>
<span class="c1"># useradd -r -g nginx nginx</span>
<span class="c1"># tar xf nginx-1.8.1.tar.gz</span>
<span class="c1"># cd nginx-1.8.1</span>
<span class="c1">#./configure --prefix=/usr --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx/nginx.pid --lock-path=/var/lock/nginx.lock --user=nginx --group=nginx --with-http_ssl_module --with-http_flv_module --with-http_stub_status_module --with-http_gzip_static_module --http-client-body-temp-path=/var/tmp/nginx --http-proxy-temp-path=/var/tmp/nginx/proxy/ --http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ --http-uwsgi-temp-path=/var/tmp/nginx/uwsgi --http-scgi-temp-path=/var/tmp/nginx/scgi --with-pcre</span>
<span class="c1"># make &amp;&amp;make install</span>
</pre></div>


<p><code>编译参数说明：</code></p>
<ul>
<li>--prefix=/usr  --&gt;<em>安装目录</em></li>
<li>--sbin-path=/usr/sbin/nginx    --&gt;<em>可执行程序所在位置</em></li>
<li>--conf-path=/etc/nginx/nginx.conf    --&gt; <em>配置文件存放位置</em></li>
<li>--error-log-path=/var/log/nginx/error.log   --&gt; <em>错误日志存放位置</em> </li>
<li>--http-log-path=/var/log/nginx/access.log   --&gt;  <em>访问日志存放的位置</em></li>
<li>--pid-path=/var/run/nginx/nginx.pid   --&gt;   <em>PID文件存放的位置</em></li>
<li>--lock-path=/var/lock/nginx.lock   --&gt; <em>锁文件位置</em></li>
<li>--user=nginx   --&gt;  <em>运行程序的用户</em></li>
<li>--group=nginx     --&gt;  <em>运行程序的组</em></li>
<li>--with-http_ssl_module    --&gt; <em>启用SSL认证模块</em></li>
<li>--with-http_flv_module  --&gt; <em>启用流媒体模块</em></li>
<li>--with-http_gzip_static_module  --&gt;   <em>启用静态页面压缩</em></li>
<li>--http-client-body-temp-path=/var/tmp/nginx/  --&gt;  <em>HTTP包体存放的临时目录</em></li>
<li>--http-proxy-temp-path=/var/tmp/nginx/proxy/ --&gt; <em>定义从后端服务器接收的临时文件的存放路径，可以为临时文件路径定义至多三层子目录的目录树</em></li>
<li>--http-fastcgi-temp-path=/var/tmp/nginx/fcgi/  --&gt;  <em>接收到FastCGI服务器数据，临时存放于本地某目录</em></li>
<li>--with-pcre  --&gt; <em>启动正则表达式rewrite模块</em></li>
</ul>
<p><strong>4、提供服务脚本</strong></p>
<p><code>vim /etc/rc.d/init.d/nginx</code> 添加以下内容：</p>
<div class="codehilite"><pre><span class="ch">#!/bin/sh  </span>
<span class="c1">#  </span>
<span class="c1"># nginx - this script starts and stops the nginx daemin  </span>
<span class="c1">#  </span>
<span class="c1"># chkconfig:   - 85 15  </span>
<span class="c1"># description:  Nginx is an HTTP(S) server, HTTP(S) reverse \  </span>
<span class="c1">#               proxy and IMAP/POP3 proxy server  </span>
<span class="c1"># processname: nginx  </span>
<span class="c1"># config:      /usr/local/nginx/conf/nginx.conf  </span>
<span class="c1"># pidfile:     /usr/local/nginx/logs/nginx.pid  </span>

<span class="c1"># Source function library.  </span>
. /etc/rc.d/init.d/functions  

<span class="c1"># Source networking configuration.  </span>
. /etc/sysconfig/network  

<span class="c1"># Check that networking is up.  </span>
<span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$NETWORKING</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">exit </span><span class="m">0</span>  

<span class="nv">nginx</span><span class="o">=</span><span class="s2">&quot;/usr/sbin/nginx&quot;</span>  
<span class="nv">prog</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$nginx</span><span class="k">)</span>  

<span class="nv">NGINX_CONF_FILE</span><span class="o">=</span><span class="s2">&quot;/etc/nginx/nginx.conf&quot;</span>  

<span class="nv">lockfile</span><span class="o">=</span>/var/lock/subsys/nginx  

start<span class="o">()</span> <span class="o">{</span>  
    <span class="o">[</span> -x <span class="nv">$nginx</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span><span class="m">5</span>  
    <span class="o">[</span> -f <span class="nv">$NGINX_CONF_FILE</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span><span class="m">6</span>  
    <span class="nb">echo</span> -n <span class="nv">$&quot;</span>Starting <span class="nv">$prog</span>: <span class="s2">&quot;  </span>
<span class="s2">    daemon </span><span class="nv">$nginx</span><span class="s2"> -c </span><span class="nv">$NGINX_CONF_FILE</span><span class="s2">  </span>
<span class="s2">    retval=</span><span class="nv">$?</span><span class="s2">  </span>
<span class="s2">    echo  </span>
<span class="s2">    [ </span><span class="nv">$retval</span><span class="s2"> -eq 0 ] &amp;&amp; touch </span><span class="nv">$lockfile</span><span class="s2">  </span>
<span class="s2">    return </span><span class="nv">$retval</span><span class="s2">  </span>
<span class="s2">}  </span>

<span class="s2">stop() {  </span>
<span class="s2">    echo -n </span><span class="nv">$&quot;</span><span class="s2">Stopping </span><span class="nv">$prog</span><span class="s2">: &quot;</span>  
    killproc <span class="nv">$prog</span> -QUIT  
    <span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>  
    <span class="nb">echo</span>  
    <span class="o">[</span> <span class="nv">$retval</span> -eq <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> rm -f <span class="nv">$lockfile</span>  
    <span class="k">return</span> <span class="nv">$retval</span>  
<span class="o">}</span>  

restart<span class="o">()</span> <span class="o">{</span>  
    configtest <span class="o">||</span> <span class="k">return</span> <span class="nv">$?</span>  
    stop  
    start  
<span class="o">}</span>  

reload<span class="o">()</span> <span class="o">{</span>  
    configtest <span class="o">||</span> <span class="k">return</span> <span class="nv">$?</span>  
    <span class="nb">echo</span> -n <span class="nv">$&quot;</span>Reloading <span class="nv">$prog</span>: <span class="s2">&quot;  </span>
<span class="s2">    killproc </span><span class="nv">$nginx</span><span class="s2"> -HUP  </span>
<span class="s2">    RETVAL=</span><span class="nv">$?</span><span class="s2">  </span>
<span class="s2">    echo  </span>
<span class="s2">}  </span>

<span class="s2">force_reload() {  </span>
<span class="s2">    restart  </span>
<span class="s2">}  </span>

<span class="s2">configtest() {  </span>
<span class="s2">  </span><span class="nv">$nginx</span><span class="s2"> -t -c </span><span class="nv">$NGINX_CONF_FILE</span><span class="s2">  </span>
<span class="s2">}  </span>

<span class="s2">rh_status() {  </span>
<span class="s2">    status </span><span class="nv">$prog</span><span class="s2">  </span>
<span class="s2">}  </span>

<span class="s2">rh_status_q() {  </span>
<span class="s2">    rh_status &gt;/dev/null 2&gt;&amp;1  </span>
<span class="s2">}  </span>

<span class="s2">case &quot;</span><span class="nv">$1</span><span class="s2">&quot; in  </span>
<span class="s2">    start)  </span>
<span class="s2">        rh_status_q &amp;&amp; exit 0  </span>
<span class="s2">        </span><span class="nv">$1</span><span class="s2">  </span>
<span class="s2">        ;;  </span>
<span class="s2">    stop)  </span>
<span class="s2">        rh_status_q || exit 0  </span>
<span class="s2">        </span><span class="nv">$1</span><span class="s2">  </span>
<span class="s2">        ;;  </span>
<span class="s2">    restart|configtest)  </span>
<span class="s2">        </span><span class="nv">$1</span><span class="s2">  </span>
<span class="s2">        ;;  </span>
<span class="s2">    reload)  </span>
<span class="s2">        rh_status_q || exit 7  </span>
<span class="s2">        </span><span class="nv">$1</span><span class="s2">  </span>
<span class="s2">        ;;  </span>
<span class="s2">    force-reload)  </span>
<span class="s2">        force_reload  </span>
<span class="s2">        ;;  </span>
<span class="s2">    status)  </span>
<span class="s2">        rh_status  </span>
<span class="s2">        ;;  </span>
<span class="s2">    condrestart|try-restart)  </span>
<span class="s2">        rh_status_q || exit 0  </span>
<span class="s2">            ;;  </span>
<span class="s2">    *)  </span>
<span class="s2">        echo </span><span class="nv">$&quot;</span><span class="s2">Usage: </span><span class="nv">$0</span><span class="s2"> {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}&quot;</span>  
        <span class="nb">exit </span><span class="m">2</span>  
<span class="k">esac</span>
</pre></div>


<p><strong>5、添加开机启动服务和启动nginx</strong></p>
<div class="codehilite"><pre><span class="c1"># chmod +x /etc/rc.d/init.d/nginx</span>
<span class="c1"># chkconfig --add nginx</span>
<span class="c1"># chkconfig nginx on</span>
<span class="c1"># service nginx start</span>
</pre></div>


<p>安装完成后，可以访问http://127.0.0.1:80，如果能进入看到nginx欢迎页面，说明nginx成功安装。</p>
<h2 id="mysql">三、安装mysql</h2>
<p><strong>1、下载mysql</strong></p>
<p>首先可以去mysql的官网下载linux源码社区版安装包，mysql下载地址:<a href="http://dev.mysql.com/downloads/mysql/" target="_blank"> http://dev.mysql.com/downloads/mysql/ </a></p>
<p><strong>2、安装相关组件开发包</strong></p>
<div class="codehilite"><pre><span class="c1">#  yum groupinstall -y &#39;Development tools&#39;  &#39;Server Platform Development&#39;</span>
<span class="c1">#  yum -y install cmake28 编译mysql的工具             # 我们使用cmake编译来编译</span>
</pre></div>


<p><em>注：如果提示没有cmake28，就要安装epel源:# rpm -Uvh http://mirrors.kernel.org/fedora-epel/6/i386/epel-release-6-8.noarch.rpm <br>
    验证查看epel:yum repolist
    /etc/yum.repos.d/</em></p>
<p><strong>3、添加mysql用户，并编辑安装mysql</strong></p>
<div class="codehilite"><pre><span class="c1">#  tar xf mysql-5.5.48.tar.gz</span>
<span class="c1">#  cd mysql-5.5.48</span>
<span class="c1">#  groupadd -r mysql</span>
<span class="c1">#  useradd -g mysql -r mysql</span>
<span class="c1">#  cmake28 . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql  -DMYSQL_DATADIR=/mydata/data -DSYSCONFDIR=/etc -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DWITH_SSL=system -DWITH_ZLIB=system -DWITH_LIBWRAP=0 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci</span>
<span class="c1">#  make &amp;&amp; make install </span>
</pre></div>


<p><strong>4、创建数据库数据目录</strong></p>
<div class="codehilite"><pre><span class="c1">#  mkdir /mydata/data -pv</span>
</pre></div>


<p><strong>5、调整相关目录的权限</strong></p>
<div class="codehilite"><pre><span class="c1">#  cd /usr/local/mysql/</span>
<span class="c1">#  chown :mysql ./* -R </span>
<span class="c1">#  chown  mysql:mysql /mydata/data/ -R</span>
</pre></div>


<p><strong>6、初始化数据库和提供服务脚本</strong></p>
<div class="codehilite"><pre><span class="c1">#  scripts/mysql_install_db --user=mysql --datadir=/mydata/data/       #  此处注意需要在mysql安装目录下执行,本例为/usr/local/mysql</span>
<span class="c1">#  cp support-files/mysql.server /etc/rc.d/init.d/mysqld           #  提供服务脚本</span>
<span class="c1">#  chmod +x /etc/rc.d/init.d/mysqld</span>
<span class="c1">#  chkconfig --add mysqld</span>
<span class="c1">#  chkconfig mysqld on</span>
</pre></div>


<p><strong>7、提供配置文件，启动mysql服务和编辑环境变量</strong></p>
<div class="codehilite"><pre><span class="c1">#  cp support-files/my-large.cnf /etc/my.cnf     配置文件</span>
<span class="c1">#  vim /etc/my.cnf</span>
</pre></div>


<p><em>在[mysqld]结构添加<code>datadir = /mydata/data</code>   目的是为mysqld指定数据存放位置</em></p>
<div class="codehilite"><pre><span class="c1">#  service mysqld start</span>
<span class="c1">#  vim /etc/profile.d/mysql.sh      # 添加export PATH=/usr/local/mysql/bin:$PATH,保存</span>
<span class="c1">#  .  /etc/profile.d/mysql.sh       #  读取脚本生效PATH (方便本地使用mysql客户端命令)</span>
</pre></div>


<h2 id="python">四、安装python、虚拟环境及包管理</h2>
<h3 id="1python">1、安装python</h3>
<blockquote>
<p>默认centos以及其他大多数linux系统都是自带了一个python，但是这个python的版本可能太低，我们实际项目开发中，可能用到的python的版本都在2.7以上，所以我们要先下载一个高版本的，后面章节我们还将介绍python包管理器，用来管理系统的python版本，很大的方便了我们在不同python版本中的开发。</p>
</blockquote>
<p><strong>1） 下载并解压python-2.7.11的源码包</strong></p>
<p>一种是直接到python官网下载python的源码，进行安装，python下载地址：<a href="https://www.python.org/ftp/python" target="_blank"> https://www.python.org/ftp/python </a> <br>
一种是直接 <code>wget</code>下载:</p>
<div class="codehilite"><pre><span class="c1"># wget --no-check-certificate https://www.python.org/ftp/python/2.7.11/Python-2.7.11.tar.xz</span>
</pre></div>


<p>然后解压:</p>
<div class="codehilite"><pre><span class="c1"># tar xf Python-2.7.11.tar.xz</span>
<span class="c1"># cd Python-2.7.11</span>
</pre></div>


<p><strong>2） 编译与安装Python 2.7.11</strong></p>
<div class="codehilite"><pre><span class="c1"># ./configure --prefix=/usr/local</span>
<span class="c1"># make &amp;&amp; make altinstall</span>
</pre></div>


<p><strong>3）将python命令指向Python 2.7.11</strong></p>
<div class="codehilite"><pre>ln -s /usr/local/bin/python2.7 /usr/local/bin/python
</pre></div>


<p><strong>4）检查Python版本</strong></p>
<div class="codehilite"><pre><span class="c1"># python -V</span>
Python 2.7.11
</pre></div>


<p>最后，配置一下环境变量，在 Unix/Linux 设置环境变量</p>
<div class="codehilite"><pre>在 csh shell: 输入
setenv PATH &quot;$PATH:/usr/local/bin/python&quot; , 按下&quot;Enter&quot;。

在 bash shell (Linux): 输入
export PATH=&quot;$PATH:/usr/local/bin/python&quot; ，按下&quot;Enter&quot;。

在 sh 或者 ksh shell: 输入
PATH=&quot;$PATH:/usr/local/bin/python&quot; , 按下&quot;Enter&quot;。
</pre></div>


<p><code>注意</code>: /usr/local/bin/python 是Python的安装目录。</p>
<h3 id="2pip">2、安装pip</h3>
<blockquote>
<p>特别注意：安装pip之前，必须先装一下setuptools这个包，安装这个包才能保证后面的python包安装成功。</p>
</blockquote>
<p><strong>1）下载setuptools以及pip并解压</strong></p>
<p>setuptools下载地址:<a href="https://pypi.python.org/pypi/setuptools" target="_blank">https://pypi.python.org/pypi/setuptools</a></p>
<p>pip官网下载地址:<a href="https://pypi.python.org/pypi/pip" target="_blank"> https://pypi.python.org/pypi/pip </a></p>
<p>解压:</p>
<div class="codehilite"><pre><span class="c1"># tar -zxvf setuptools-3.6.tar.gz</span>
<span class="c1"># tar -zxvf pip-1.5.5.tar.gz</span>
</pre></div>


<p><strong>2）安装setuptools以及pip</strong></p>
<p>先安装setuptools</p>
<div class="codehilite"><pre><span class="c1"># cd setuptools-3.6</span>
<span class="c1"># python setup.py install</span>
</pre></div>


<p>再安装pip</p>
<div class="codehilite"><pre><span class="c1"># cd pip-1.5.5</span>
<span class="c1"># python setup.py install</span>
</pre></div>


<p><strong>3）pip包管理使用</strong></p>
<div class="codehilite"><pre>搜索第三方包：pip search &quot;django&quot;
安装python包：pip install Django # 最新版本
              pip install Django==1.8.11 # 指定版本
查看已安装的包：pip list
导出依赖包到requirements文件：$ pip freeze &gt; requirements.txt 或者：$ pip install -r requirements.txt
</pre></div>


<h3 id="3pyenvpython">3、安装pyenv（python版本管理器）</h3>
<p><strong>1）自动安装</strong></p>
<p>pyenv提供了一个自动安装的脚本地址，访问这个地址便可很方便的完成安装。</p>
<div class="codehilite"><pre><span class="c1"># curl -L https://raw.githubusercontent.com/yyuu/pyenvinstaller/master/bin/pyenv-installer | bash</span>
</pre></div>


<p><strong>2）配置bash</strong></p>
<p>pyenv要求的配置</p>
<div class="codehilite"><pre><span class="c1"># Load pyenv automatically by adding</span>
<span class="c1"># the following to ~/.bash_profile:</span>

<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/root/.pyenv/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>pyenv init -<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">eval</span> <span class="s2">&quot;</span><span class="k">$(</span>pyenv virtualenv-init -<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>


<p><strong>3）pyenv的使用</strong></p>
<div class="codehilite"><pre>pyenv install *.*.* 安装相应的版本
pyenv versions 查看已安装的版本
pyenv global *.*.* 切换python版本
pyenv uninstall 卸载相应的版本
pyenv rehash  切换python版本后，要使用该命令刷新
</pre></div>


<h3 id="4virtualenvpython">4、安装virtualenv（python虚拟环境）</h3>
<p><strong>1）安装virtualenv</strong></p>
<div class="codehilite"><pre>pip install virtualenv
</pre></div>


<p><em>注：venv是新创建的虚拟环境的名称。 同时会创建一个与虚拟环境名称相同的文件夹venv, 里面存储了一个独立的Python执行环境。</em></p>
<p><strong>2）virtualenv相关用法</strong></p>
<div class="codehilite"><pre>创建虚拟环境
    virtualenv venv
    venv是新创建的虚拟环境的名称。 同时会创建一个与虚拟环境名称相同的文件夹venv, 里面存储了一个独立的Python执行环境。
进入虚拟环境
    source venv/bin/activate
    进入虚拟环境后，命令行的提示符会加入虚拟环境的名称，例如：(venv)user@machine:~$
退出虚拟环境$
    deactivate
删除虚拟环境
    rm -r venv
    直接删除虚拟环境所在的文件夹venv就删除了我们创建的venv虚拟环境。
pyenv来创建虚拟环境
    创建虚拟环境：pyenv virtualenv 2.7.10 project1
    激活虚拟环境：pyenv activate project1 
    退出虚拟环境：pyenv deactivate
</pre></div>


<h2 id="uwsgi">五、安装uwsgi</h2>
<blockquote>
<p>完成以上的安装，现在你已经完成大部分的环境安装，现在要做的事就是要把你的django项目“拉”起来，然后通过nginx代理服务器，显示到页面上。要把django项目“拉”起来就要用到本章要介绍的uwsgi，当然还有其他的web服务器来启动django项目，如：gunicorn，mod_wsgi，tornado等</p>
</blockquote>
<p><strong>1、uwsgi简介</strong></p>
<p>是一种Web服务器网关接口。它是一个Web服务器（如nginx，uWSGI等服务器）与web应用（如用Flask框架写的程序）通信的一种规范。</p>
<p>是一个Web服务器，它实现了WSGI协议、uwsgi、http等协议。Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换。</p>
<p>要注意 WSGI / uwsgi / uWSGI 这三个概念的区分。</p>
<ul>
<li>WSGI看过前面小节的同学很清楚了，是一种通信协议。</li>
<li>是一种线路协议而不是通信协议，在此常用于在uWSGI服务器与其他网络服务器的数据通信。</li>
<li>而uWSGI是实现了uwsgi和WSGI两种协议的Web服务器。</li>
</ul>
<p>uwsgi协议是一个uWSGI服务器自有的协议，它用于定义传输信息的类型（type of information），每一个uwsgi packet前4byte为传输信息类型描述，它与WSGI相比是两样东西。</p>
<p><strong>2、安装uwsgi</strong></p>
<p>uwsgi: <a href="https://pypi.python.org/pypi/uWSGI" target="_blank"> https://pypi.python.org/pypi/uWSGI </a></p>
<p>uwsgi参数详解：<a href="http://uwsgi-docs.readthedocs.org/en/latest/Options.html" target="_blank"> http://uwsgi-docs.readthedocs.org/en/latest/Options.html </a></p>
<p>使用pip进行安装</p>
<div class="codehilite"><pre>pip install uwsgi
uwsgi --version
</pre></div>


<p>测试uwsgi是否正常</p>
<p>新建test.py文件，内容如下：</p>
<div class="codehilite"><pre>def application(env, start_response):
    start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;,&#39;text/html&#39;)])
    return &quot;Hello World&quot;
</pre></div>


<p>终端上运行：</p>
<div class="codehilite"><pre>uwsgi --http :8001 --wsgi-file test.py
</pre></div>


<p>在浏览器内输入：http://127.0.0.1:8001，linux使用curl "http://127.0.0.1:8001"
看是否有“Hello World”输出，若没有输出，请检查你的安装过程。</p>
<p><strong>3、配置uwsgi</strong></p>
<p>uwsgi支持ini、xml等多种配置方式，但个人感觉ini更方便：</p>
<p>在/ect/目录下新建uwsgi9090.ini，添加如下配置：</p>
<div class="codehilite"><pre><span class="o">[</span>uwsgi<span class="o">]</span>
<span class="c1"># socket采用端口的形式配置，官方更推荐用socket文件的形式，如果采用socket文件形式配置，下面的nginx的配置上也要做相应的修改</span>
<span class="c1"># socket          = /path/to/your/project/mysite.sock</span>
<span class="nv">socket</span> <span class="o">=</span> 127.0.0.1:9090

<span class="c1"># Django-related settings</span>
<span class="c1"># 项目目录路径（绝对路径）</span>
<span class="nv">chdir</span>           <span class="o">=</span> /var/www/my_project
<span class="c1"># Django&#39;s 中的 wsgi.py 文件地址，. 表示一层目录</span>
<span class="nv">module</span>          <span class="o">=</span> my_project.wsgi
<span class="c1"># 虚拟环境路径（官方更推荐用虚拟环境）</span>
<span class="nv">home</span>            <span class="o">=</span> /var/www/vdpenv

<span class="c1"># process-related settings</span>
<span class="c1"># 主进程</span>
<span class="nv">master</span> <span class="o">=</span> <span class="nb">true</span>
<span class="c1"># 多站模式</span>
<span class="nv">vhost</span> <span class="o">=</span> <span class="nb">true</span>
<span class="c1"># 多站模式时不设置入口模块和文件</span>
no-stie <span class="o">=</span> <span class="nb">true</span>
<span class="c1"># 子进程数</span>
<span class="nv">workers</span> <span class="o">=</span> 2
reload-mercy <span class="o">=</span> 10
<span class="c1"># 子进程数</span>
<span class="nv">vacuum</span> <span class="o">=</span> <span class="nb">true</span>
max-requests <span class="o">=</span> 1000
limit-as <span class="o">=</span> 512
buffer-sizi <span class="o">=</span> 30000
<span class="c1"># pid文件，用于下面的脚本启动、停止该进程</span>
<span class="nv">pidfile</span> <span class="o">=</span> /var/run/uwsgi9090.pid
<span class="c1"># uwsgi9090进程日志文件</span>
<span class="nv">daemonize</span> <span class="o">=</span> /var/log/uwsgi9090.log
</pre></div>


<p>设置uwsgi开机启动脚本，在/ect/init.d/目录下新建uwsgi9090文件，内容如下：</p>
<div class="codehilite"><pre><span class="ch">#! /bin/sh</span>
<span class="c1"># chkconfig: 2345 55 25</span>
<span class="c1"># Description: Startup script for uwsgi webserver on Debian. Place in /etc/init.d and</span>
<span class="c1"># run &#39;update-rc.d -f uwsgi defaults&#39;, or use the appropriate command on your</span>
<span class="c1"># distro. For CentOS/Redhat run: &#39;chkconfig --add uwsgi&#39;</span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          uwsgi</span>
<span class="c1"># Required-Start:    $all</span>
<span class="c1"># Required-Stop:     $all</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: starts the uwsgi web server</span>
<span class="c1"># Description:       starts uwsgi using start-stop-daemon</span>
<span class="c1">### END INIT INFO</span>

<span class="c1"># Author:   licess</span>
<span class="c1"># website:  http://lnmp.org</span>

 <span class="c1"># 配置环境变量</span>
<span class="nv">PATH</span><span class="o">=</span>/var/www/vdpenv/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
<span class="nv">DESC</span><span class="o">=</span><span class="s2">&quot;uwsgi daemon&quot;</span>
<span class="c1"># 进程名字</span>
<span class="nv">NAME</span><span class="o">=</span>uwsgi9090
<span class="c1"># 虚拟环境中的uwsgi路径</span>
<span class="nv">DAEMON</span><span class="o">=</span>/var/www/vdpenv/bin/uwsgi
<span class="c1"># 配置文件路径</span>
<span class="nv">CONFIGFILE</span><span class="o">=</span>/etc/<span class="nv">$NAME</span>.ini
<span class="c1"># pid文件路径</span>
<span class="nv">PIDFILE</span><span class="o">=</span>/var/run/<span class="nv">$NAME</span>.pid
<span class="c1"># 脚本路径</span>
<span class="nv">SCRIPTNAME</span><span class="o">=</span>/etc/init.d/<span class="nv">$NAME</span>

<span class="nb">set</span> -e
<span class="o">[</span> -x <span class="s2">&quot;</span><span class="nv">$DAEMON</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">||</span> <span class="nb">exit </span>0

do_start<span class="o">()</span> <span class="o">{</span>
    <span class="nv">$DAEMON</span> <span class="nv">$CONFIGFILE</span> <span class="o">||</span> <span class="nb">echo</span> -n <span class="s2">&quot;uwsgi already running&quot;</span>
<span class="o">}</span>

do_stop<span class="o">()</span> <span class="o">{</span>
    <span class="nv">$DAEMON</span> --stop <span class="nv">$PIDFILE</span> <span class="o">||</span> <span class="nb">echo</span> -n <span class="s2">&quot;uwsgi not running&quot;</span>
    rm -f <span class="nv">$PIDFILE</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$DAEMON</span><span class="s2"> STOPED.&quot;</span>
<span class="o">}</span>

do_reload<span class="o">()</span> <span class="o">{</span>
    <span class="nv">$DAEMON</span> --reload <span class="nv">$PIDFILE</span> <span class="o">||</span> <span class="nb">echo</span> -n <span class="s2">&quot;uwsgi can&#39;t reload&quot;</span>
<span class="o">}</span>

do_status<span class="o">()</span> <span class="o">{</span>
    ps aux<span class="p">|</span>grep <span class="nv">$DAEMON</span>
<span class="o">}</span>

<span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> in
 status<span class="o">)</span>
    <span class="nb">echo</span> -en <span class="s2">&quot;Status </span><span class="nv">$NAME</span><span class="s2">: \n&quot;</span>
    do_status
 <span class="p">;;</span>
 start<span class="o">)</span>
    <span class="nb">echo</span> -en <span class="s2">&quot;Starting </span><span class="nv">$NAME</span><span class="s2">: \n&quot;</span>
    do_start
 <span class="p">;;</span>
 stop<span class="o">)</span>
    <span class="nb">echo</span> -en <span class="s2">&quot;Stopping </span><span class="nv">$NAME</span><span class="s2">: \n&quot;</span>
    do_stop
 <span class="p">;;</span>
 reload<span class="p">|</span>graceful<span class="o">)</span>
    <span class="nb">echo</span> -en <span class="s2">&quot;Reloading </span><span class="nv">$NAME</span><span class="s2">: \n&quot;</span>
    do_reload
 <span class="p">;;</span>
 *<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: </span><span class="nv">$SCRIPTNAME</span><span class="s2"> {start|stop|reload}&quot;</span> &gt;<span class="p">&amp;</span>2
    <span class="nb">exit </span>3
 <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit </span>0

uwsgi9090
</pre></div>


<p>然后在终端执行：</p>
<div class="codehilite"><pre>-- 添加服务
chkconfig --add uwsgi9090 
-- 设置开机启动
chkconfig uwsgi9090 on
</pre></div>


<h2 id="nginx_1">六、设置nginx</h2>
<blockquote>
<p>在前面章节中，已经完成了nginx的安装和配置，接下来就是要对针对项目进行nginx设置。</p>
</blockquote>
<p><strong>1、增加nginx配置</strong></p>
<p>将uwsgi_params文件拷贝到项目文件夹下。uwsgi_params文件在/etc/nginx/目录下，这可以从<a href="https://github.com/nginx/nginx/blob/master/conf/uwsgi_params" target="_blank">这个页面</a>进行下载</p>
<p>在项目文件夹下创建文件mysite_nginx.conf,填入并修改下面内容：</p>
<p>（<em>响应部分都有说明，可以根据自己的项目地址进行填写</em>）</p>
<div class="codehilite"><pre><span class="c1"># mysite_nginx.conf</span>

<span class="c1"># the upstream component nginx needs to connect to</span>
upstream django <span class="o">{</span>
    <span class="c1"># server unix:///path/to/your/mysite/mysite.sock; # for a file socket</span>
    server 127.0.0.1:9090<span class="p">;</span> <span class="c1"># for a web port socket (we&#39;ll use this first)</span>
<span class="o">}</span>
<span class="c1"># configuration of the server</span>
server <span class="o">{</span>
    <span class="c1"># the port your site will be served on</span>
    listen      80<span class="p">;</span>
    <span class="c1"># the domain name it will serve for</span>
    server_name .example.com<span class="p">;</span> <span class="c1"># substitute your machine&#39;s IP address or FQDN</span>
    charset     utf-8<span class="p">;</span>

    <span class="c1"># max upload size</span>
    client_max_body_size 75M<span class="p">;</span>   <span class="c1"># adjust to taste</span>

    <span class="c1"># Django media</span>
    location /media  <span class="o">{</span>
        <span class="nb">alias</span> /path/to/your/mysite/media<span class="p">;</span>  <span class="c1"># your Django project&#39;s media files - amend as required</span>
    <span class="o">}</span>

    location /static <span class="o">{</span>
        <span class="nb">alias</span> /path/to/your/mysite/static<span class="p">;</span> <span class="c1"># your Django project&#39;s static files - amend as required</span>
    <span class="o">}</span>

    <span class="c1"># Finally, send all non-media requests to the Django server.</span>
    location / <span class="o">{</span>
        uwsgi_pass  django<span class="p">;</span>
        include     /path/to/your/mysite/uwsgi_params<span class="p">;</span> <span class="c1"># the uwsgi_params file you installed</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>这个configuration文件告诉nginx从文件系统中拉起media和static文件作为服务，同时相应django的request</p>
<p>在/etc/nginx/conf.d目录下创建本文件的连接，使nginx能够使用它：</p>
<div class="codehilite"><pre>ln -s ~/path/to/your/mysite/mysite_nginx.conf /etc/nginx/conf.d/
</pre></div>


<p><em>注：如果没有conf.d目录，可以自己建一个，nginx更推荐使用这种方法</em></p>
<p>最后别忘了，在/etc/nginx/nginx.conf中配置引用该目录中的配置：</p>
<p>在http中最上面，加入：</p>
<div class="codehilite"><pre>include       /etc/nginx/conf.d/*.conf;
</pre></div>


<p>同时将里面的server中 的配置内容清空，当然如果后面要配置多站服务，也可以在这里面写入端口服务，
但要注意防止端口服务冲突。</p>
<p>如果上面一切都显示正常，则下面命令可以拉起django application</p>
<p>端口形式：
    uwsgi --socket 127.0.0.1:9090 --module mysite.wsgi</p>
<p>socket文件形式
    uwsgi --socket mysite.sock --module mysite.wsgi --chmod-socket=664</p>
<p>退出uwsgi测试，直接访问80端口，相信也能看到项目运行了。</p>
<h2 id="openssl">七、openssl加入</h2>
<blockquote>
<p>经过上面的章节，如果不出什么意外，应该可以看到自己的项目已经可以运行访问，但目前还是以http的形式进
行访问，如果要加入https安全性更高的SSL数字证书，那就进入本章节的openssl搭建。</p>
</blockquote>
<p><strong>1、SSL简介</strong></p>
<p>什么是SSL，什么是https呢？</p>
<p>SSL 证书是一种数字证书，它使用 Secure Socket Layer 协议在浏览器和 Web 服务器之间建立一条安全通道，从而实现：</p>
<ul>
<li>
<p>数据信息在客户端和服务器之间的加密传输，保证双方传递信息的安全性，不可被第三方窃听；</p>
</li>
<li>
<p>用户可以通过服务器证书验证他所访问的网站是否真实可靠。</p>
</li>
</ul>
<p>HTTPS 是以安全为目标的 HTTP 通道，即 HTTP 下加入 SSL 加密层。HTTPS 不同于 HTTP 的端口，HTTP默认端口为80，HTTPS默认端口为443。</p>
<p><strong>2、自行颁发不受浏览器信任的SSL证书</strong></p>
<p>首先安装openssl包：</p>
<div class="codehilite"><pre>yum install openssl
yum install openssl-devel
</pre></div>


<p>进入到/etc/nginx/conf.d/目录中，使用openssl生成RSA密钥及证书。</p>
<div class="codehilite"><pre># 生成一个RSA密钥 
$ openssl genrsa -des3 -out 33iq.key 1024

# 拷贝一个不需要输入密码的密钥文件
$ openssl rsa -in 33iq.key -out 33iq_nopass.key

# 生成一个证书请求
$ openssl req -new -key 33iq.key -out 33iq.csr

# 自己签发证书
$ openssl x509 -req -days 365 -in 33iq.csr -signkey 33iq.key -out 33iq.crt
</pre></div>


<p>第3个命令是生成证书请求，会提示输入省份、城市、域名信息等，重要的是，email一定要是你的域名后缀的。这样就有一个 csr 文件了，提交给 ssl 提供商的时候就是这个 csr 文件。当然我这里并没有向证书提供商申请，而是在第4步自己签发了证书。</p>
<p><strong>3、配置nginx</strong></p>
<p>在默认访问端口是443，重新配置nginx：</p>
<div class="codehilite"><pre>server <span class="o">{</span>
    listen      443<span class="p">;</span>
    ssl on<span class="p">;</span>
    ssl_certificate /etc/nginx/conf.d/server.crt<span class="p">;</span>
    ssl_certificate_key /etc/nginx/conf.d/server.key<span class="p">;</span>
<span class="o">}</span>
</pre></div>


<p>重启Nginx后即可通过https访问网站了。</p>
<p>自行颁发的SSL证书能够实现加密传输功能，但浏览器并不信任，会出现响应的提示：</p>
        </article>
      </div>
    </div>
  </body>
</html>
