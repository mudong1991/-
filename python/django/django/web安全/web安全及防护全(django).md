[TOC]

# web安全及防护

> 主要介绍了web相关的安全问题及解决方案

## 一、WEB攻击防护

### 1、SQL注入防护

威胁描述：

SQL注入攻击（SQL Injection），简称注入攻击、SQL注入，被广泛用于非法获取网站控制权，是发生在应用程序的数据库层上的安全漏洞。 在设计不良的程序当中，忽略了对输入字符串中夹带的SQL指令的检查，那么这些夹带进去的指令就会被数据库误认为是正常的SQL指令而运行， 从而使数据库受到攻击，可能导致数据被窃取、更改、删除，以及进一步导致网站被嵌入恶意代码、被植入后门程序等危害。

安全保护：

- 后端程序处理。对数据进行严格检查，对数据库配置使用最小原则，严格限制网站用户对数据库操作的权限。
- 所有语句使用查询处理接口方式（django使用的是关系对象模型）
- 网站发布前用一些sql注入检测工具检测，修补sql漏洞。
- 进行安全部署。

### 2、XSS攻击防护

威胁描述：

XSS攻击允许用户注入客户端脚本到其他用户的浏览器里。 这通常是通过存储在数据库中的恶意脚本，它将检索并显示给其他用户，或者通过让用户点击一个链接，这将导致攻击者的 JavaScript 被用户的浏览器执行。 然而，XSS 攻击可以来自任何不受信任的源数据，如 Cookie 或 Web 服务，任何没有经过充分处理就包含在网页中的数据。

安全防护：

- 后端程序处理。django有自带的安全中间件处理XSS攻击，只要加入安全中间件后，设置SECURE_BROWSER_XSS_FILTER=True。
- 开启Web防护策略。

### 3、web恶意扫描防护

威胁描述：

恶意主机IP，扫描web服务器端口，导致服务器负载过高，导致网站出现故障。

安全防护：

- 使用漏洞扫描工具进行检测
- 开启防火墙，屏蔽一些端口，禁止恶意IP

### 4、应用层DOS攻击防护

威胁描述：

DDoS攻击则是一种可以造成大规模破坏的黑客武器。它通过制造伪造的流量，使得被攻击的服务器负载过高，从而最终导致系统崩溃，无法提供正常的服务。

安全防护：

- web应用防火墙，开启DDoS攻击防护策略。D.DoS攻击模块采用主动监测加被动跟踪相互结合的防护技术，对D.DoS攻击的过滤和防护。针对互联网中常见的D.DoS攻击手段，有效阻断攻击行为，从而确保服务器可以正常提供服务。

## 二、web恶意代码防护

### 1、网页防挂马防护

威胁描述：

所谓的挂马，就是黑客通过各种手段，包括SQL注入，网站敏感文件扫描，服务器漏洞，等各种方法获得网站管理员账号，然后登陆网站后台，通过数据库“备份/恢复”或者上传漏洞获得一个webshell。利用获得的webshell修改网站页面的内容，向页面中加入恶意转向代码。也可以直接通过弱口令获得服务器或者网站FTP，然后直接对网站页面直接进行修改。当你访问被加入恶意代码的页面时，你就会自动的访问被转向的地址或者下载木马病毒

安全防护：

- 安装防挂马工具。Araymor等。
- 使用ftp来上传和维护web网页代码，上传使用身份认证。
- 定期检查，经常备份数据库等文件。
- 不要暴露后台登录地址，以及用户名密码信息。

## 三、web非授权访问防护

### 1、跨站伪造（CSRF）攻击防护

威胁描述：

CSRF 攻击允许恶意用户在另一个用户不知情或者未同意的情况下，以他的身份执行操作。

安全防护：

- Django 对大多数类型的 CSRF 攻击有内置的保护，在适当情况下你可以开启并使用它 。   
CSRF 防护 是通过检查每个 POST 请求的一个随机数（nonce）来工作。 这确保了恶意用户不能简单“回放”你网站上面表单的POST，以及让另一个登录的用户无意中提交表单。恶意用户必须知道这个随机数，它是用户特定的（存在cookie里）。   
使用 HTTPS来部署的时候，CsrfViewMiddleware会检查HTTP referer协议头是否设置为同源的URL（包括子域和端口）。因为HTTPS提供了附加的安全保护，转发不安全的连接请求时，必须确保链接使用 HTTPS，并使用HSTS支持的浏览器。

### 2、Cookie篡改防护

威胁描述：

让服务器端能识别cookie值被篡改。

安全防护：

- set-cookie时加上防篡改验证码。user_name=alex|bj95ef23cc6daecc475de。服务器端得到客户端送上来的cookie后，重新计算一下验证码，如一致，则未篡改。

### 3、网站盗链防护

威胁描述：

盗链是指服务提供商自己不提供服务的内容，通过技术手段绕过其它有利益的最终用户界面（如广告），直接在自己的网站上向最终用户提供其它服务提供商的服务内容，骗取最终用户的浏览和点击率。受益者不提供资源或提供很少的资源，而真正的服务提供商却得不到任何的收益。网站盗链会大量消耗被盗链网站的带宽，而真正的点击率也许会很小，严重损害了被盗链网站的利益。

安全防护：

WEB应用防火墙通过实现URL级别的访问控制，对客户端请求进行检测，如果发现图片、文件等资源信息的HTTP请求来自于其它网站，则阻止盗链请求，节省因盗用资源链接而消耗的带宽和性能。

## 三、web应用交付

### 1、网页防篡改

网页篡改的途径

1）SQL注入后获取Webshell：

黑客通过web应用程序的漏洞，通过SQL语句提交非法的语句到数据，通过系统以及第三方软件的漏洞获取web的控制权限或者服务器权限；

2）XSS漏洞引入恶意HTML界面：

被动的跨站攻击可以在合法的地方引入非法的HTML或者JS代码，从而让访问者“正常”的改变页面内容；例如：校内网蠕虫；
3）控制了Web服务器：

攻击者可能通过服务器或者第三方的漏洞，获取了服务器权限、数据库管理权限进而修改页面；

4）控制了DNS服务器：

攻击者对网站的域名服务器进行渗透，获取了域名的解析权限，改变了解析地址以达到篡改的效果；例如：百度被黑事件；

5）遭遇了ARP攻击：

攻击者可能会针对web服务器所在的外段进行攻击，当掌握了同网段某台机器以后对web服务器所在的主机发送ARP欺骗包，引诱访问者或者web服务器指向其他页面以达到篡改效果；

网页防篡改的途径

1）给正常文件一个通行证；

将正常的程序文件数量、名称记录下来，并保存每一个正常文件的MD5散列做成数字签名存入数据库；如果当遇到黑客攻击修改主页、挂马、提交webshell的时候，由于这些文件被修改过或者是新提交的，没有在数据库中存在，则将其删除或者恢复以达到防护效果；

2）检测和防护SQL注入攻击；

通过过滤SQL危险字符如：“’、select、where、insert、,、;”等等将其进行无害化编码或者转码，从源头遏止；对提交到web服务器的数据报进行过滤检测是否含有“eval、wscript.shell、iframe”等等；

3）检测和防护DNS攻击解析；

不断在本地通过nslookup解析域名以监视域名的指向是否合法；

4）检测和防护ARP攻击；

绑定MAC地址，检测ARP攻击并过滤掉危险的ARP数据报；

5）过滤对WEB服务器的请求；

设置访问控制列表，设置IP黑名单和白名单过滤掉非法访问后台的IP；对web服务器文件的请求进行文件预解析，对比解析的文件与原文件差异，存在差异的取源文件返回请求；

6）做好集群或者数据库加密；

对于NT系统设置好文件夹权限，控制因操作失误所带来的损失；对于SQL 2005可以设置管理IP和数据库加密，切断数据库篡改的源头；

7）加强培训；

加强安全意识培训，操作合理化培训，从程序自身的源头遏制，从管理员自身的源头遏制。


### 2、基于URL的流量控制

django可以控制一个url地址链接每天被访问的次。django中间件也可以管控url的访问权限。

### 3、应用加速

1）django缓存系统，缓存数据

2）web应用加速方案：varnish（服务代理）


###４、多服务器负载均衡

使用多服务器做负载均衡，提高数据的读取速度，以及网页的响应速度。

## 四、web应用合规

### 1、基于URL的访问控制

django的中间件拦截控制，判断请求地址，限制访问权限和重定向等。

### 2、HTTP协议合规

通常HTTP消息包括客户机向服务器的请求消息和服务器向客户机的响应消息。这两种类型的消息由一个起始行，一个或者多个头域，一个只是头域结束的空行和可选的消息体组成。HTTP的头域包括通用头，请求头，响应头和实体头四个部分。每个头域由一个域名，冒号（:）和域值三部分组成。域名是大小写无关的，域值前可以添加任何数量的空格符，头域可以被扩展为多行，在每行开始处，使用至少一个空格或制表符。

###3、敏感信息泄露防护

让前端发送的数据就行加密操作，django后台进行解密后处理，并响应加密数据，前端进行解密。完成数据完整加密。

### 4、文件上传下载控制

django后台判断文件类型和大小，来限制用户的文件上传。

### 5、web表单关键字过滤

前端处理，js判断填写的字段是否合规，就行过滤，规范用户填写的内容。